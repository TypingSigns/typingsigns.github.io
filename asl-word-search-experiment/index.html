<!DOCTYPE html>
<html lang="en">

<!-- Note:
	2017-08-30
		- Server is required as data-files are too large to be 	‚Ü≥ loaded via a simple js script. e.g.:
			python -m SimpleHTTPServer 8008
 -->

<head>
	<meta charset="UTF-8">
	<title>ASL Word Search Experiment</title>
	<meta name="description" content="Director of ASL signs. Searchable by GLOSS.">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="viewport" content="width=device-width">

	<script src="js/jquery.min.js"></script>
	<script src="js/sifter.js"></script>

	<script src="/js/ga-track.js"></script>

	<style>
		html, body {
			margin: 0;
			padding: 0;
			background-color: #EEE;
		}
		.searchbar-container {
			/* manual hacky placements - could be ‚àëly redone */
			background-color: #EEE;
			width: 100%;
			/*height: 3em;*/
			position: fixed;
			top: 0;
			z-index: 20;
			text-align: center;
			box-shadow: 0px 1px 10px #999;
		}
			.search-icon {
				position: relative;
				height: 0;
				font-size: 1.8em;
				top: -2em;
				left: -354px;
				/*left: -406px;*/
				color: #BBB;
			}
			#searchbar {
				/*width: 90%;*/
				/*margin: 0.5em 5%;*/
				width: 720px;
				margin: 1em;

				font-size: 1.2em;
				box-sizing: border-box;
				padding-left: 35px;
				padding-top: 10px;
				padding-bottom: 10px;
				
				border-radius: 5px;
				border-color: transparent;
				box-shadow: 1px 1px 10px #999;
			}
		.searchbar-container-spacing {
			height: 6em;
		}
		#page {
			max-width: 800px;
			margin: auto;
		}
		/*‚¨á*/
		#STAT {
			margin: 1em 5%;
		}
		body.data-loaded #STAT {
			display: none;
		}
		#results {
			margin: 0 5%;
			margin-bottom: 2em;
			font-family: sans-serif;
			font-size: 1.2em;
		}
		#results .item {
			/*border: 1px solid lightgray;*/
			border-radius: 5px;
			padding: 0.5em;
			background-color: white;
			margin: 10px 0;
			box-shadow: 1px 1px 1px grey;
		}
		#results .item > div {
			display: table-cell; 
			position: relative;
			/*display: inline; */
		}
		#results .item .label {
			/*background-color: cyan;*/
			width: 80px;
			max-width: 80px;
			padding-left: 10px;
			vertical-align: middle;
			white-space: pre-wrap;
			z-index: 10;
		}
		#results .item .content {
			padding-left: 20px;
			/*background-color: orange;*/
			padding-top: 5px;
			padding-bottom: 5px;
			z-index: 1;
		}		
		#results .item .content img {
			max-height: 200px;
		}
		#results .item a {
			vertical-align: top;
			padding-right: 0.5em;
			/*background-color: yellow;*/
			text-decoration: none;
			z-index: 10;
		}

		#results .item a.link-content {
			padding: 20px;
			display: inline-block;
			background-color: peachpuff;
			border-radius: 5px;
			box-shadow: 1px 1px 5px black;
		}
		#results .item a.link-content.lifeprint {
			background-color: lemonchiffon;
		}
		#results .item a.link-content.handspeak {
			background-color: lightcyan;
		}
	</style>
</head>

<body>
	<div class="searchbar-container">
		<!-- <input id="searchbar" type="text" placeholder="Shortcuts: Use [ ` ] or [ / ] to focus here"> -->
		
		<input id="searchbar" type="text" placeholder="Search ASL signs">
		<div class="search-icon" style="-webkit-transform: rotate(-45deg); 
               -moz-transform: rotate(-45deg); 
                 -o-transform: rotate(-45deg);
                    transform: rotate(-45deg);">&#9906;
                </div>
	</div>
	<div class="searchbar-container-spacing"></div>
	<div id="page">
		<pre id="STAT">Loading</pre>
		<div id="results">Loading ... ‚è≥</div>
	</div>
</body>

<!-- STAT CONVENIENCE FUNCTION -->
<script>
	function _STAT(text) {
		$('#STAT').text(text);
		text = "STATUS: " + text;
		console.log(text);
	}
</script>

<!-- LOAD DIRECTORY SCRIPT -->
<script>
	var sifter;
	var myDirectory = [] // entry = ["type"]["id"]["url"]["titles"]
	
	// SIGNBANK DATA: Load and Add
	function loadSignbank(callback) {
		$.ajax({
			// url : "https://raw.githubusercontent.com/TypingSigns/typingsigns.github.io/master/asl-word-search-experiment/data/signbank-id-url-titles-fsw-mediaandsignid.tsv",
			url : "data/signbank-id-url-titles-fsw-mediaandsignid.tsv",
			dataType: "text",
			success : function (data_signbank) {
				_STAT("	‚Ü≥ Loaded SignBank Directory üòÅ")
				_STAT("	‚Ü≥ Processing SignBank Directory ‚è≥ ...")
				// Add Data
				var lines = data_signbank.split("\n")
				for (var i=0; i<lines.length; i++) {
					var columns = lines[i].split("\t");
					var entry = {}
					entry["type"] = "signbank"
					entry["id"] = columns[0];
					entry["url"] = columns[1];
					entry["titles"] = columns[2];
					entry["fsw"] = columns[3]; // only used for checking if an fsw-string existed, fsw itself is not used.
					entry["mediaandsignid"] = columns[4];
					myDirectory.push(entry)
				}
				_STAT("	‚Ü≥ Processed SignBank Directory üòÅ")

				// NEXT:
				callback()
			}
		});
	}
	

	

	function processASLLex(callback) {
		_STAT("Loading ASLLex directory ‚è≥ ...")
		$.ajax({
			url : "data/asllex-id-url-title-youtubeid.tsv",
			dataType: "text",
			success : function (data_asllex) {
				_STAT("	‚Ü≥ Loaded ASLLex Directory üòÅ")
				_STAT("	‚Ü≥ Processing ASLLex Directory ‚è≥ ...")
				// Add Data
				var lines = data_asllex.split("\n")
				for (var i=0; i<lines.length; i++) {
					var columns = lines[i].split("\t");
					var entry = {}
					entry["type"] = "asllex"
					entry["id"] = columns[0];
					entry["url"] = columns[1];
					entry["titles"] = columns[2];
					entry["youtubeid"] = columns[3];
					myDirectory.push(entry)
				}
				_STAT("	‚Ü≥ Processed ASLLex Directory üòÅ")

				// NEXT:
				callback()
			}
		});
	}

	function processSpreadTheSign(callback) {
		_STAT("Loading STS directory ‚è≥ ...")
		$.ajax({
			url : "data/spreadthesign-id-url-title-~videopageid.tsv",
			dataType: "text",
			success : function (data_sts) {
				_STAT("	‚Ü≥ Loaded STS Directory üòÅ")
				_STAT("	‚Ü≥ Processing STS Directory ‚è≥ ...")
				// Add Data
				var lines = data_sts.split("\n")
				for (var i=0; i<lines.length; i++) {
					var columns = lines[i].split("\t");
					var entry = {}
					entry["type"] = "sts"
					entry["id"] = columns[0];
					entry["url"] = columns[1];
					entry["titles"] = columns[2];
					entry["videoid"] = columns[3];
					myDirectory.push(entry)
				}
				_STAT("	‚Ü≥ Processed STS Directory üòÅ")

				// NEXT:
				callback()
			}
		});
	}

	function processMSHWords(callback) {
		_STAT("Loading MSHWords directory ‚è≥ ...")
		$.ajax({
			url : "data/yout-mshwords-id-url-title-youtubeid.tsv",
			dataType: "text",
			success : function (data_mshwords) {
				_STAT("	‚Ü≥ Loaded MSHWords Directory üòÅ")
				_STAT("	‚Ü≥ Processing MSHWords Directory ‚è≥ ...")
				// Add Data
				var lines = data_mshwords.split("\n")
				for (var i=0; i<lines.length; i++) {
					var columns = lines[i].split("\t");
					var entry = {}
					entry["type"] = "mshwords"
					entry["id"] = columns[0];
					entry["url"] = columns[1];
					entry["titles"] = columns[2];
					entry["youtubeid"] = columns[3];
					myDirectory.push(entry)
				}
				_STAT("	‚Ü≥ Processed MSHWords Directory üòÅ")

				// NEXT:
				callback()
			}
		});
	}

	function processMSHAnim(callback) {
		_STAT("Loading MSHAnim directory ‚è≥ ...")
		$.ajax({
			url : "data/yout-mshanim-id-url-title-youtubeid.tsv",
			dataType: "text",
			success : function (data_mshanim) {
				_STAT("	‚Ü≥ Loaded MSHAnim Directory üòÅ")
				_STAT("	‚Ü≥ Processing MSHAnim Directory ‚è≥ ...")
				// Add Data
				var lines = data_mshanim.split("\n")
				for (var i=0; i<lines.length; i++) {
					var columns = lines[i].split("\t");
					var entry = {}
					entry["type"] = "mshanim"
					entry["id"] = columns[0];
					entry["url"] = columns[1];
					entry["titles"] = columns[2];
					entry["youtubeid"] = columns[3];
					myDirectory.push(entry)
				}
				_STAT("	‚Ü≥ Processed MSHAnim Directory üòÅ")

				// NEXT:
				callback()
			}
		});
	}

	function processASLKids(callback) {
		_STAT("Loading ASLKids directory ‚è≥ ...")
		$.ajax({
			url : "data/yout-aslkids-id-url-title-youtubeid.tsv",
			dataType: "text",
			success : function (data_aslkids) {
				_STAT("	‚Ü≥ Loaded ASLKids Directory üòÅ")
				_STAT("	‚Ü≥ Processing ASLKids Directory ‚è≥ ...")
				// Add Data
				var lines = data_aslkids.split("\n")
				for (var i=0; i<lines.length; i++) {
					var columns = lines[i].split("\t");
					var entry = {}
					entry["type"] = "aslkids"
					entry["id"] = columns[0];
					entry["url"] = columns[1];
					entry["titles"] = columns[2];
					entry["youtubeid"] = columns[3];
					myDirectory.push(entry)
				}
				_STAT("	‚Ü≥ Processed ASLKids Directory üòÅ")

				// NEXT:
				callback()
			}
		});
	}

	function processHandspeak(callback) {
		_STAT("Loading Handspeak directory ‚è≥ ...")
		$.ajax({
			url : "data/handspeak-id-url-title.tsv",
			dataType: "text",
			success : function (data_handspeak) {
				_STAT("	‚Ü≥ Loaded Handspeak Directory üòÅ")
				_STAT("	‚Ü≥ Processing Handspeak Directory ‚è≥ ...")
				// Add Data
				var lines = data_handspeak.split("\n")
				for (var i=0; i<lines.length; i++) {
					var columns = lines[i].split("\t");
					var entry = {}
					entry["type"] = "handspeak"
					entry["id"] = columns[0];
					entry["url"] = columns[1];
					entry["titles"] = columns[2];
					myDirectory.push(entry)
				}
				_STAT("	‚Ü≥ Processed Handspeak Directory üòÅ")

				// NEXT:
				callback()
			}
		});
	}

	function processLifeprint(callback) {
		_STAT("Loading Lifeprint directory ‚è≥ ...")
		$.ajax({
			url : "data/lifeprint-id-url-title.tsv",
			dataType: "text",
			success : function (data_lifeprint) {
				_STAT("	‚Ü≥ Loaded Lifeprint Directory üòÅ")
				_STAT("	‚Ü≥ Processing Lifeprint Directory ‚è≥ ...")
				// Add Data
				var lines = data_lifeprint.split("\n")
				for (var i=0; i<lines.length; i++) {
					var columns = lines[i].split("\t");
					var entry = {}
					entry["type"] = "lifeprint"
					entry["id"] = columns[0];
					entry["url"] = columns[1];
					entry["titles"] = columns[2];
					myDirectory.push(entry)
				}
				_STAT("	‚Ü≥ Processed Lifeprint Directory üòÅ")

				// NEXT:
				callback()
			}
		});
	}

	function processGiphySWR(callback) {
		_STAT("Loading GiphySWR directory ‚è≥ ...")
		$.ajax({
			url : "data/giphyswr-id-url-titles-mediaurl.tsv",
			dataType: "text",
			success : function (data_giphyswr) {
				_STAT("	‚Ü≥ Loaded GiphySWR Directory üòÅ")
				_STAT("	‚Ü≥ Processing GiphySWR Directory ‚è≥ ...")
				// Add Data
				var lines = data_giphyswr.split("\n")
				for (var i=0; i<lines.length; i++) {
					var columns = lines[i].split("\t");
					var entry = {}
					entry["type"] = "giphyswr"
					entry["id"] = columns[0];
					entry["url"] = columns[1];
					entry["titles"] = columns[2];
					entry["mediaurl"] = columns[3];
					myDirectory.push(entry)
				}
				_STAT("	‚Ü≥ Processed GiphySWR Directory üòÅ")

				// NEXT:
				callback()
			}
		});
	}

	function processNab(callback) {
		_STAT("Loading Nab directory ‚è≥ ...")
		$.ajax({
			url : "data/yout-nabboudatuofa-id-url-title-youtubeid.tsv",
			dataType: "text",
			success : function (data_nab) {
				_STAT("	‚Ü≥ Loaded Nab Directory üòÅ")
				_STAT("	‚Ü≥ Processing Nab Directory ‚è≥ ...")
				// Add Data
				var lines = data_nab.split("\n")
				for (var i=0; i<lines.length; i++) {
					var columns = lines[i].split("\t");
					var entry = {}
					entry["type"] = "nab"
					entry["id"] = columns[0];
					entry["url"] = columns[1];
					entry["titles"] = columns[2];
					entry["youtubeid"] = columns[3];
					myDirectory.push(entry)
				}
				_STAT("	‚Ü≥ Processed Nab Directory üòÅ")

				// NEXT:
				callback()
			}
		});
	}
</script>

<!-- AFTER ALL DATA LOADED -->
<script>
	function updateResults(searchvalue) {
		var resultsDomId = '#results'

		_STAT("Conducting Search ...")
		var results = sifter.search(searchvalue, {
			fields: ['titles'],
			limit: 50
		});
		$(resultsDomId).html("")
		var table_html = "" //~
		var table_html_contents = ""
		for (var i=0; i<results.items.length; i++) {
			var itemId = results.items[i].id;
			var item = sifter.items[itemId];
			var titles = item.titles;
			var url = item.url;
			var html = "";
			var html_content = "";
			var html_label = '<a href="'+url+'">'+titles+'</a>';
			
			switch (item.type) {
				case 'sts':
					html_content += '<img src="https://s3.amazonaws.com/awss3-typingsigns-201710/sts-gifs-6/'+item.videoid+'.gif">';
					// html += '<img src="data/images/spreadthesign _private/gifs/'+item.videoid+'.gif">';
					html_content += ' <a class="link-content sts" href="'+url+'">'+'STS'+'</a>';
					break;
				case 'lifeprint':
					html_content += '<a class="link-content lifeprint" href="'+url+'">'+'Lifeprint'+'</a>';
					break;
				case 'handspeak':
					html_content += '<a class="link-content handspeak" href="'+url+'">'+'Handspeak'+'</a>';
					break;
				case 'signbank':
					if (item.fsw) {
						html_content += '<img src="data/images/signbank/pngs-by-sid/'+item.mediaandsignid+'.png">';
					} else {
						html_content += ' { no fsw }';
					}
					break;
				case 'giphyswr':
					html_content += '<img src="'+item.mediaurl+'">';
					break;
				case 'asllex':
				case 'mshwords':
				case 'mshanim':
				case 'aslkids':
				case 'nab':
					// A. Simple Youtube Embed w/- suggested videos
						// var embedurl = 'https://www.youtube.com/embed/'+item.youtubeid+'?rel=0'
					// B.i. Looping Embed - No Autoplay
						var embedurl = "https://www.youtube.com/embed/"+item.youtubeid+"?autoplay=0&loop=1&controls=0&loop=1&playlist="+item.youtubeid+";&amp;showinfo=0"
					// B.ii. Looping Autoplaying Embed, Muted.
						// var embedurl = "https://www.youtube.com/embed/"+item.youtubeid+"?autoplay=1&mute=1&loop=1&controls=0&loop=1&playlist="+item.youtubeid+";&amp;showinfo=0"
					// Embed:
					html_content += '<iframe width="267" height="200" src="'+embedurl+'"></iframe>';
					break;
			}

			html = '<div class="item">' + 
						'<div class="label">'+html_label+'</div>' + 
						'<div class="content">'+html_content+'</div>' + 
					'</div>';
			$(resultsDomId).append(html)

			// var row_html = '<tr>' +
			// 				'<td>'+html_label+'</td>' +
			// 				'<td>'+html_content+'</td>' +
			// 			'</tr>'
			// table_html_contents += row_html;
		}
		// table_html = '<table>' + table_html_contents + '<table>';
		// $(resultsDomId).append(table_html)

		_STAT("	‚Ü≥ Conducted Search")
	}

	function refreshResultsFromInput() {
		// Get Value
		var searchvalue = $('#searchbar').val();
		if (searchvalue == "") { _STAT("ALERT: Please enter some text."); }

		window.scrollTo(0, 0); // Scroll to top

		////////////////////////////////////////////////////
		updateResults(searchvalue)
	}
</script>

<!-- MAIN DOCUMENT READY FUNCTION -->
<script>

	$(document).ready(function() {

		/////////////////////////////////////////////
		// Listen for Keypress
		$(window).keypress(function(e) {
			var key = e.which;
			console.log('key:',key);
			if (key == 96 || key == 47) { // '`' or '/'
				// $('#searchbar').focus(); // focuses without selecting all text
				$('#searchbar').select(); // focuses and selects all text
				e.preventDefault();
			}
		});
		/////////////////////////////////////////////

		_STAT("Creating Directory ‚è≥ ...")
		_STAT("Loading SignBank directory ‚è≥ ...")
		loadSignbank(function() {
			processASLLex(function() {
				processSpreadTheSign(function() {
					processMSHWords(function() {
						processMSHAnim(function() {
							processASLKids(function() {
								processHandspeak(function() {
									processLifeprint(function() {
										processGiphySWR(function() {
											processNab(function() {

													// LAST DATA PROCESSED!

													// Create Sifter from Directory
													_STAT("Created Directory üòÅ")
													_STAT("Creating Sifter for Search ...")
													sifter = new Sifter(myDirectory);
													_STAT("	‚Ü≥ Created Sifter for Search.")

													// Listen to Search bar
													_STAT("Initializing Search Bar.")
													refreshResultsFromInput();
													$('#searchbar').focus();
													$('#searchbar').on('input', function(e) {
														refreshResultsFromInput();
													});

													// Tell Body, all data has loaded.
													$('body').addClass('data-loaded');

											})
										})
									})
								})
							})
						})
					})
				})
			})
		})

		

	});
</script>


</html>
