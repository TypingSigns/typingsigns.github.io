<!DOCTYPE html>
<html lang="en">

<!-- Note:
	2017-08-30
		- Server is required as data-files are too large to be 	‚Ü≥ loaded via a simple js script. e.g.:
			python -m SimpleHTTPServer 8008
 -->

<head>
	<meta charset="UTF-8">
	<title>ASL Word Search</title>
	<meta name="description" content="Director of ASL signs. Searchable by GLOSS.">
	<meta name="apple-mobile-web-app-capable" content="yes">

	<script src="js/jquery.min.js"></script>
	<script src="js/sifter.js"></script>

	<script src="/js/ga-track.js"></script>
</head>

<body>
	<pre id="STAT">Loading</pre>
	<input id="searchbar" type="text">
	<pre id="results">Results ...</pre>
</body>

<script>
	function _STAT(text) {
		$('#STAT').text(text);
		text = "_STAT: " + text;
		console.log(text);
	}

	$(document).ready(function() {

		var sifter;

		_STAT("Creating Directory ‚è≥ ...")
		var myDirectory = []
		// entry = ["type"]["id"]["url"]["titles"]
		
		// SIGNBANK DATA: Load and Add
		_STAT("Loading SignBank directory ‚è≥ ...")
		$.ajax({
			url : "data/signbank-id-url-titles-fsw-mediaandsignid.tsv",
			dataType: "text",
			success : function (data_signbank) {
				_STAT("	‚Ü≥ Loaded SignBank Directory üòÅ")
				_STAT("	‚Ü≥ Processing SignBank Directory ‚è≥ ...")
				// Add Data
				var lines = data_signbank.split("\n")
				for (var i=0; i<lines.length; i++) {
					var columns = lines[i].split("\t");
					var entry = {}
					entry["type"] = "signbank"
					entry["id"] = columns[0];
					entry["url"] = columns[1];
					entry["titles"] = columns[2];
					entry["fsw"] = columns[3]; // only used for checking if an fsw-string existed, fsw itself is not used.
					entry["mediaandsignid"] = columns[4];
					myDirectory.push(entry)
				}
				_STAT("	‚Ü≥ Processed SignBank Directory üòÅ")

				// NEXT:
				// lastDataProcessed()
				processASLLex()
			}
		});

		function processASLLex() {
			_STAT("Loading ASLLex directory ‚è≥ ...")
			$.ajax({
				url : "data/asllex-id-url-title-youtubeid.tsv",
				dataType: "text",
				success : function (data_asllex) {
					_STAT("	‚Ü≥ Loaded ASLLex Directory üòÅ")
					_STAT("	‚Ü≥ Processing ASLLex Directory ‚è≥ ...")
					// Add Data
					var lines = data_asllex.split("\n")
					for (var i=0; i<lines.length; i++) {
						var columns = lines[i].split("\t");
						var entry = {}
						entry["type"] = "asllex"
						entry["id"] = columns[0];
						entry["url"] = columns[1];
						entry["titles"] = columns[2];
						entry["youtubeid"] = columns[3];
						myDirectory.push(entry)
					}
					_STAT("	‚Ü≥ Processed ASLLex Directory üòÅ")

					// NEXT:
					processMSHWords()
				}
			});
		}

		function processMSHWords() {
			_STAT("Loading MSHWords directory ‚è≥ ...")
			$.ajax({
				url : "data/yout-mshwords-id-url-title-youtubeid.tsv",
				dataType: "text",
				success : function (data_mshwords) {
					_STAT("	‚Ü≥ Loaded MSHWords Directory üòÅ")
					_STAT("	‚Ü≥ Processing MSHWords Directory ‚è≥ ...")
					// Add Data
					var lines = data_mshwords.split("\n")
					for (var i=0; i<lines.length; i++) {
						var columns = lines[i].split("\t");
						var entry = {}
						entry["type"] = "mshwords"
						entry["id"] = columns[0];
						entry["url"] = columns[1];
						entry["titles"] = columns[2];
						entry["youtubeid"] = columns[3];
						myDirectory.push(entry)
					}
					_STAT("	‚Ü≥ Processed MSHWords Directory üòÅ")

					// NEXT:
					processMSHAnim()
				}
			});
		}

		function processMSHAnim() {
			_STAT("Loading MSHAnim directory ‚è≥ ...")
			$.ajax({
				url : "data/yout-mshanim-id-url-title-youtubeid.tsv",
				dataType: "text",
				success : function (data_mshanim) {
					_STAT("	‚Ü≥ Loaded MSHAnim Directory üòÅ")
					_STAT("	‚Ü≥ Processing MSHAnim Directory ‚è≥ ...")
					// Add Data
					var lines = data_mshanim.split("\n")
					for (var i=0; i<lines.length; i++) {
						var columns = lines[i].split("\t");
						var entry = {}
						entry["type"] = "mshanim"
						entry["id"] = columns[0];
						entry["url"] = columns[1];
						entry["titles"] = columns[2];
						entry["youtubeid"] = columns[3];
						myDirectory.push(entry)
					}
					_STAT("	‚Ü≥ Processed MSHAnim Directory üòÅ")

					// NEXT:
					processASLKids()
				}
			});
		}

		function processASLKids() {
			_STAT("Loading ASLKids directory ‚è≥ ...")
			$.ajax({
				url : "data/yout-aslkids-id-url-title-youtubeid.tsv",
				dataType: "text",
				success : function (data_aslkids) {
					_STAT("	‚Ü≥ Loaded ASLKids Directory üòÅ")
					_STAT("	‚Ü≥ Processing ASLKids Directory ‚è≥ ...")
					// Add Data
					var lines = data_aslkids.split("\n")
					for (var i=0; i<lines.length; i++) {
						var columns = lines[i].split("\t");
						var entry = {}
						entry["type"] = "aslkids"
						entry["id"] = columns[0];
						entry["url"] = columns[1];
						entry["titles"] = columns[2];
						entry["youtubeid"] = columns[3];
						myDirectory.push(entry)
					}
					_STAT("	‚Ü≥ Processed ASLKids Directory üòÅ")

					// NEXT:
					processHandspeak()
				}
			});
		}

		function processHandspeak() {
			_STAT("Loading Handspeak directory ‚è≥ ...")
			$.ajax({
				url : "data/handspeak-id-url-title.tsv",
				dataType: "text",
				success : function (data_handspeak) {
					_STAT("	‚Ü≥ Loaded Handspeak Directory üòÅ")
					_STAT("	‚Ü≥ Processing Handspeak Directory ‚è≥ ...")
					// Add Data
					var lines = data_handspeak.split("\n")
					for (var i=0; i<lines.length; i++) {
						var columns = lines[i].split("\t");
						var entry = {}
						entry["type"] = "handspeak"
						entry["id"] = columns[0];
						entry["url"] = columns[1];
						entry["titles"] = columns[2];
						myDirectory.push(entry)
					}
					_STAT("	‚Ü≥ Processed Handspeak Directory üòÅ")

					// NEXT:
					processLifeprint()
				}
			});
		}

		function processLifeprint() {
			_STAT("Loading Lifeprint directory ‚è≥ ...")
			$.ajax({
				url : "data/lifeprint-id-url-title.tsv",
				dataType: "text",
				success : function (data_lifeprint) {
					_STAT("	‚Ü≥ Loaded Lifeprint Directory üòÅ")
					_STAT("	‚Ü≥ Processing Lifeprint Directory ‚è≥ ...")
					// Add Data
					var lines = data_lifeprint.split("\n")
					for (var i=0; i<lines.length; i++) {
						var columns = lines[i].split("\t");
						var entry = {}
						entry["type"] = "lifeprint"
						entry["id"] = columns[0];
						entry["url"] = columns[1];
						entry["titles"] = columns[2];
						myDirectory.push(entry)
					}
					_STAT("	‚Ü≥ Processed Lifeprint Directory üòÅ")

					// NEXT:
					processGiphySWR()
				}
			});
		}

		function processGiphySWR() {
			_STAT("Loading GiphySWR directory ‚è≥ ...")
			$.ajax({
				url : "data/giphyswr-id-url-titles-mediaurl.tsv",
				dataType: "text",
				success : function (data_giphyswr) {
					_STAT("	‚Ü≥ Loaded GiphySWR Directory üòÅ")
					_STAT("	‚Ü≥ Processing GiphySWR Directory ‚è≥ ...")
					// Add Data
					var lines = data_giphyswr.split("\n")
					for (var i=0; i<lines.length; i++) {
						var columns = lines[i].split("\t");
						var entry = {}
						entry["type"] = "giphyswr"
						entry["id"] = columns[0];
						entry["url"] = columns[1];
						entry["titles"] = columns[2];
						entry["mediaurl"] = columns[3];
						myDirectory.push(entry)
					}
					_STAT("	‚Ü≥ Processed GiphySWR Directory üòÅ")

					// NEXT:
					processNab()
				}
			});
		}

		function processNab() {
			_STAT("Loading Nab directory ‚è≥ ...")
			$.ajax({
				url : "data/yout-nabboudatuofa-id-url-title-youtubeid.tsv",
				dataType: "text",
				success : function (data_nab) {
					_STAT("	‚Ü≥ Loaded Nab Directory üòÅ")
					_STAT("	‚Ü≥ Processing Nab Directory ‚è≥ ...")
					// Add Data
					var lines = data_nab.split("\n")
					for (var i=0; i<lines.length; i++) {
						var columns = lines[i].split("\t");
						var entry = {}
						entry["type"] = "nab"
						entry["id"] = columns[0];
						entry["url"] = columns[1];
						entry["titles"] = columns[2];
						entry["youtubeid"] = columns[3];
						myDirectory.push(entry)
					}
					_STAT("	‚Ü≥ Processed Nab Directory üòÅ")

					// NEXT:
					lastDataProcessed()
				}
			});
		}

		////////////////////////////////////////////////////
		////////////////////////////////////////////////////
		////////////////////////////////////////////////////
		// ALL DATA 	‚Ü≥ LOADED

		function lastDataProcessed() {
			_STAT("Created Directory üòÅ")

			////////////////////////////////////////////////////
			_STAT("Creating Sifter for Search ...")
			sifter = new Sifter(myDirectory);
			_STAT("	‚Ü≥ Created Sifter for Search.")

			////////////////////////////////////////////////////
			_STAT("Initializing Search Bar.")
			refreshResultsFromInput();
			$('#searchbar').focus();
			$('#searchbar').on('input', function(e) {
				refreshResultsFromInput();
			})
		}

		function refreshResultsFromInput() {
			// Get Value
			var searchvalue = $('#searchbar').val();
			if (searchvalue == "") { _STAT("ALERT: Please enter some text."); }

			////////////////////////////////////////////////////
			_STAT("Conducting Search ...")
			var results = sifter.search(searchvalue, {
				fields: ['titles'],
				limit: 50
			});
			$('#results').html("")
			for (var i=0; i<results.items.length; i++) {
				var itemId = results.items[i].id;
				var item = sifter.items[itemId];
				var titles = item.titles;
				var url = item.url;
				var html = '<a href="'+url+'">'+titles+'</a>';
				
				switch (item.type) {
					case 'lifeprint':
						html += ' - Lifeprint';
						break;
					case 'handspeak':
						html += ' - Handspeak';
						break;
					case 'signbank':
						if (item.fsw) {
							html += '<img src="data/images/signbank/pngs-by-sid/'+item.mediaandsignid+'.png">';
						} else {
							html += ' { no fsw }';
						}
						break;
					case 'giphyswr':
						html += '<img src="'+item.mediaurl+'">';
						break;
					case 'asllex':
					case 'mshwords':
					case 'mshanim':
					case 'aslkids':
					case 'nab':
						// A. Simple Youtube Embed w/- suggested videos
							// var embedurl = 'https://www.youtube.com/embed/'+item.youtubeid+'?rel=0'
						// B.i. Looping Embed - No Autoplay
							var embedurl = "https://www.youtube.com/embed/"+item.youtubeid+"?autoplay=0&loop=1&controls=0&loop=1&playlist="+item.youtubeid+";&amp;showinfo=0"
						// B.ii. Looping Autoplaying Embed, Muted.
							// var embedurl = "https://www.youtube.com/embed/"+item.youtubeid+"?autoplay=1&mute=1&loop=1&controls=0&loop=1&playlist="+item.youtubeid+";&amp;showinfo=0"
						// Embed:
						html += '<iframe width="420" height="315" src="'+embedurl+'"></iframe>';
						break;

				}
				html += "\n";

				$('#results').append(html)
			}
			_STAT("	‚Ü≥ Conducted Search")
		}

	});
</script>


</html>