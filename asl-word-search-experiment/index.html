<!DOCTYPE html>
<html lang="en">

<!-- Note:
	2017-08-30
		- Server is required as data-files are too large to be 	‚Ü≥ loaded via a simple js script. e.g.:
			python -m SimpleHTTPServer 8008
 -->

<head>
	<meta charset="UTF-8">
	<title>ASL Word Search Experiment</title>
	<meta name="description" content="Director of ASL signs. Searchable by GLOSS.">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="viewport" content="width=device-width">

	<script src="js/jquery.min.js"></script>
	<script src="js/sifter.js"></script>

	<script src="/js/ga-track.js"></script>

	<style>
		html, body {
			margin: 0;
			padding: 0;
		}
		.searchbar-container {
			background: lightgray;
			width: 100%;
			/*height: 3em;*/
			position: fixed;
			top: 0;

		}
			#searchbar {
				width: 90%;
				margin: 0.5em 5%;
				font-size: 1.1em;
			}
		.searchbar-container-tail {
			height: 3em;
		}
		#STAT {
			margin: 1em 5%;
		}
		#results {
			margin: 0 5%;
			margin-bottom: 2em;
		}
		#results .item {
			border: 1px solid lightgray;
			padding: 0.5em;
		}
		#results .item a {
			vertical-align: top;
			padding-right: 0.5em;
		}

		#results .item a.link-content {
			padding: 20px;
			display: inline-block;
			background-color: peachpuff;
		}
		#results .item a.link-content.lifeprint {
			background-color: lemonchiffon;
		}
		#results .item a.link-content.handspeak {
			background-color: lightcyan;
		}
	</style>
</head>

<body>
	<div class="searchbar-container">
		<input id="searchbar" type="text" placeholder="Shortcuts: Use [ ` ] or [ / ] to focus here">
	</div>
	<div class="searchbar-container-tail"></div>
	<pre id="STAT">Loading</pre>
	<pre id="results">Results ...</pre>
</body>

<!-- STAT CONVENIENCE FUNCTION -->
<script>
	function _STAT(text) {
		$('#STAT').text(text);
		text = "STATUS: " + text;
		console.log(text);
	}
</script>

<!-- LOAD DIRECTORY SCRIPT -->
<script>
	var sifter;
	var myDirectory = [] // entry = ["type"]["id"]["url"]["titles"]
	
	// SIGNBANK DATA: Load and Add
	function loadSignbank(callback) {
		$.ajax({
			// url : "https://raw.githubusercontent.com/TypingSigns/typingsigns.github.io/master/asl-word-search-experiment/data/signbank-id-url-titles-fsw-mediaandsignid.tsv",
			url : "data/signbank-id-url-titles-fsw-mediaandsignid.tsv",
			dataType: "text",
			success : function (data_signbank) {
				_STAT("	‚Ü≥ Loaded SignBank Directory üòÅ")
				_STAT("	‚Ü≥ Processing SignBank Directory ‚è≥ ...")
				// Add Data
				var lines = data_signbank.split("\n")
				for (var i=0; i<lines.length; i++) {
					var columns = lines[i].split("\t");
					var entry = {}
					entry["type"] = "signbank"
					entry["id"] = columns[0];
					entry["url"] = columns[1];
					entry["titles"] = columns[2];
					entry["fsw"] = columns[3]; // only used for checking if an fsw-string existed, fsw itself is not used.
					entry["mediaandsignid"] = columns[4];
					myDirectory.push(entry)
				}
				_STAT("	‚Ü≥ Processed SignBank Directory üòÅ")

				// NEXT:
				callback()
			}
		});
	}
	

	

	function processASLLex(callback) {
		_STAT("Loading ASLLex directory ‚è≥ ...")
		$.ajax({
			url : "data/asllex-id-url-title-youtubeid.tsv",
			dataType: "text",
			success : function (data_asllex) {
				_STAT("	‚Ü≥ Loaded ASLLex Directory üòÅ")
				_STAT("	‚Ü≥ Processing ASLLex Directory ‚è≥ ...")
				// Add Data
				var lines = data_asllex.split("\n")
				for (var i=0; i<lines.length; i++) {
					var columns = lines[i].split("\t");
					var entry = {}
					entry["type"] = "asllex"
					entry["id"] = columns[0];
					entry["url"] = columns[1];
					entry["titles"] = columns[2];
					entry["youtubeid"] = columns[3];
					myDirectory.push(entry)
				}
				_STAT("	‚Ü≥ Processed ASLLex Directory üòÅ")

				// NEXT:
				callback()
			}
		});
	}

	function processSpreadTheSign(callback) {
		_STAT("Loading STS directory ‚è≥ ...")
		$.ajax({
			url : "data/spreadthesign-id-url-title-~videopageid.tsv",
			dataType: "text",
			success : function (data_sts) {
				_STAT("	‚Ü≥ Loaded STS Directory üòÅ")
				_STAT("	‚Ü≥ Processing STS Directory ‚è≥ ...")
				// Add Data
				var lines = data_sts.split("\n")
				for (var i=0; i<lines.length; i++) {
					var columns = lines[i].split("\t");
					var entry = {}
					entry["type"] = "sts"
					entry["id"] = columns[0];
					entry["url"] = columns[1];
					entry["titles"] = columns[2];
					entry["videoid"] = columns[3];
					myDirectory.push(entry)
				}
				_STAT("	‚Ü≥ Processed STS Directory üòÅ")

				// NEXT:
				callback()
			}
		});
	}

	function processMSHWords(callback) {
		_STAT("Loading MSHWords directory ‚è≥ ...")
		$.ajax({
			url : "data/yout-mshwords-id-url-title-youtubeid.tsv",
			dataType: "text",
			success : function (data_mshwords) {
				_STAT("	‚Ü≥ Loaded MSHWords Directory üòÅ")
				_STAT("	‚Ü≥ Processing MSHWords Directory ‚è≥ ...")
				// Add Data
				var lines = data_mshwords.split("\n")
				for (var i=0; i<lines.length; i++) {
					var columns = lines[i].split("\t");
					var entry = {}
					entry["type"] = "mshwords"
					entry["id"] = columns[0];
					entry["url"] = columns[1];
					entry["titles"] = columns[2];
					entry["youtubeid"] = columns[3];
					myDirectory.push(entry)
				}
				_STAT("	‚Ü≥ Processed MSHWords Directory üòÅ")

				// NEXT:
				callback()
			}
		});
	}

	function processMSHAnim(callback) {
		_STAT("Loading MSHAnim directory ‚è≥ ...")
		$.ajax({
			url : "data/yout-mshanim-id-url-title-youtubeid.tsv",
			dataType: "text",
			success : function (data_mshanim) {
				_STAT("	‚Ü≥ Loaded MSHAnim Directory üòÅ")
				_STAT("	‚Ü≥ Processing MSHAnim Directory ‚è≥ ...")
				// Add Data
				var lines = data_mshanim.split("\n")
				for (var i=0; i<lines.length; i++) {
					var columns = lines[i].split("\t");
					var entry = {}
					entry["type"] = "mshanim"
					entry["id"] = columns[0];
					entry["url"] = columns[1];
					entry["titles"] = columns[2];
					entry["youtubeid"] = columns[3];
					myDirectory.push(entry)
				}
				_STAT("	‚Ü≥ Processed MSHAnim Directory üòÅ")

				// NEXT:
				callback()
			}
		});
	}

	function processASLKids(callback) {
		_STAT("Loading ASLKids directory ‚è≥ ...")
		$.ajax({
			url : "data/yout-aslkids-id-url-title-youtubeid.tsv",
			dataType: "text",
			success : function (data_aslkids) {
				_STAT("	‚Ü≥ Loaded ASLKids Directory üòÅ")
				_STAT("	‚Ü≥ Processing ASLKids Directory ‚è≥ ...")
				// Add Data
				var lines = data_aslkids.split("\n")
				for (var i=0; i<lines.length; i++) {
					var columns = lines[i].split("\t");
					var entry = {}
					entry["type"] = "aslkids"
					entry["id"] = columns[0];
					entry["url"] = columns[1];
					entry["titles"] = columns[2];
					entry["youtubeid"] = columns[3];
					myDirectory.push(entry)
				}
				_STAT("	‚Ü≥ Processed ASLKids Directory üòÅ")

				// NEXT:
				callback()
			}
		});
	}

	function processHandspeak(callback) {
		_STAT("Loading Handspeak directory ‚è≥ ...")
		$.ajax({
			url : "data/handspeak-id-url-title.tsv",
			dataType: "text",
			success : function (data_handspeak) {
				_STAT("	‚Ü≥ Loaded Handspeak Directory üòÅ")
				_STAT("	‚Ü≥ Processing Handspeak Directory ‚è≥ ...")
				// Add Data
				var lines = data_handspeak.split("\n")
				for (var i=0; i<lines.length; i++) {
					var columns = lines[i].split("\t");
					var entry = {}
					entry["type"] = "handspeak"
					entry["id"] = columns[0];
					entry["url"] = columns[1];
					entry["titles"] = columns[2];
					myDirectory.push(entry)
				}
				_STAT("	‚Ü≥ Processed Handspeak Directory üòÅ")

				// NEXT:
				callback()
			}
		});
	}

	function processLifeprint(callback) {
		_STAT("Loading Lifeprint directory ‚è≥ ...")
		$.ajax({
			url : "data/lifeprint-id-url-title.tsv",
			dataType: "text",
			success : function (data_lifeprint) {
				_STAT("	‚Ü≥ Loaded Lifeprint Directory üòÅ")
				_STAT("	‚Ü≥ Processing Lifeprint Directory ‚è≥ ...")
				// Add Data
				var lines = data_lifeprint.split("\n")
				for (var i=0; i<lines.length; i++) {
					var columns = lines[i].split("\t");
					var entry = {}
					entry["type"] = "lifeprint"
					entry["id"] = columns[0];
					entry["url"] = columns[1];
					entry["titles"] = columns[2];
					myDirectory.push(entry)
				}
				_STAT("	‚Ü≥ Processed Lifeprint Directory üòÅ")

				// NEXT:
				callback()
			}
		});
	}

	function processGiphySWR(callback) {
		_STAT("Loading GiphySWR directory ‚è≥ ...")
		$.ajax({
			url : "data/giphyswr-id-url-titles-mediaurl.tsv",
			dataType: "text",
			success : function (data_giphyswr) {
				_STAT("	‚Ü≥ Loaded GiphySWR Directory üòÅ")
				_STAT("	‚Ü≥ Processing GiphySWR Directory ‚è≥ ...")
				// Add Data
				var lines = data_giphyswr.split("\n")
				for (var i=0; i<lines.length; i++) {
					var columns = lines[i].split("\t");
					var entry = {}
					entry["type"] = "giphyswr"
					entry["id"] = columns[0];
					entry["url"] = columns[1];
					entry["titles"] = columns[2];
					entry["mediaurl"] = columns[3];
					myDirectory.push(entry)
				}
				_STAT("	‚Ü≥ Processed GiphySWR Directory üòÅ")

				// NEXT:
				callback()
			}
		});
	}

	function processNab(callback) {
		_STAT("Loading Nab directory ‚è≥ ...")
		$.ajax({
			url : "data/yout-nabboudatuofa-id-url-title-youtubeid.tsv",
			dataType: "text",
			success : function (data_nab) {
				_STAT("	‚Ü≥ Loaded Nab Directory üòÅ")
				_STAT("	‚Ü≥ Processing Nab Directory ‚è≥ ...")
				// Add Data
				var lines = data_nab.split("\n")
				for (var i=0; i<lines.length; i++) {
					var columns = lines[i].split("\t");
					var entry = {}
					entry["type"] = "nab"
					entry["id"] = columns[0];
					entry["url"] = columns[1];
					entry["titles"] = columns[2];
					entry["youtubeid"] = columns[3];
					myDirectory.push(entry)
				}
				_STAT("	‚Ü≥ Processed Nab Directory üòÅ")

				// NEXT:
				callback()
			}
		});
	}
</script>

<!-- AFTER ALL DATA LOADED -->
<script>
function refreshResultsFromInput() {
	// Get Value
	var searchvalue = $('#searchbar').val();
	if (searchvalue == "") { _STAT("ALERT: Please enter some text."); }

	window.scrollTo(0, 0); // Scroll to top

	var resultsDomId = '#results'

	////////////////////////////////////////////////////
	_STAT("Conducting Search ...")
	var results = sifter.search(searchvalue, {
		fields: ['titles'],
		limit: 50
	});
	$(resultsDomId).html("")
	for (var i=0; i<results.items.length; i++) {
		var itemId = results.items[i].id;
		var item = sifter.items[itemId];
		var titles = item.titles;
		var url = item.url;
		var html = '<div class="item">';
		html += '<a href="'+url+'">'+titles+'</a>';
		
		switch (item.type) {
			case 'sts':
				html += '<img src="https://s3.amazonaws.com/awss3-typingsigns-201710/sts-gifs-6/'+item.videoid+'.gif">';
				// html += '<img src="data/images/spreadthesign _private/gifs/'+item.videoid+'.gif">';
				html += ' - ' + '<a class="link-content sts" href="'+url+'">'+'STS'+'</a>';
				break;
			case 'lifeprint':
				html += ' - ' + '<a class="link-content lifeprint" href="'+url+'">'+'Lifeprint'+'</a>';
				break;
			case 'handspeak':
				html += ' - ' + '<a class="link-content handspeak" href="'+url+'">'+'Handspeak'+'</a>';
				break;
			case 'signbank':
				if (item.fsw) {
					html += '<img src="data/images/signbank/pngs-by-sid/'+item.mediaandsignid+'.png">';
				} else {
					html += ' { no fsw }';
				}
				break;
			case 'giphyswr':
				html += '<img src="'+item.mediaurl+'">';
				break;
			case 'asllex':
			case 'mshwords':
			case 'mshanim':
			case 'aslkids':
			case 'nab':
				// A. Simple Youtube Embed w/- suggested videos
					// var embedurl = 'https://www.youtube.com/embed/'+item.youtubeid+'?rel=0'
				// B.i. Looping Embed - No Autoplay
					var embedurl = "https://www.youtube.com/embed/"+item.youtubeid+"?autoplay=0&loop=1&controls=0&loop=1&playlist="+item.youtubeid+";&amp;showinfo=0"
				// B.ii. Looping Autoplaying Embed, Muted.
					// var embedurl = "https://www.youtube.com/embed/"+item.youtubeid+"?autoplay=1&mute=1&loop=1&controls=0&loop=1&playlist="+item.youtubeid+";&amp;showinfo=0"
				// Embed:
				html += '<iframe width="420" height="315" src="'+embedurl+'"></iframe>';
				break;

		}
		html += "</div>";

		$(resultsDomId).append(html)
	}
	_STAT("	‚Ü≥ Conducted Search")
}
</script>

<script>

	$(document).ready(function() {

		/////////////////////////////////////////////
		// Listen for Keypress
		$(window).keypress(function(e) {
			var key = e.which;
			console.log('key:',key);
			if (key == 96 || key == 47) { // '`' or '/'
				// $('#searchbar').focus(); // focuses without selecting all text
				$('#searchbar').select(); // focuses and selects all text
				e.preventDefault();
			}
		});
		/////////////////////////////////////////////

		_STAT("Creating Directory ‚è≥ ...")
		_STAT("Loading SignBank directory ‚è≥ ...")
		loadSignbank(function() {
			processASLLex(function() {
				processSpreadTheSign(function() {
					processMSHWords(function() {
						processMSHAnim(function() {
							processASLKids(function() {
								processHandspeak(function() {
									processLifeprint(function() {
										processGiphySWR(function() {
											processNab(function() {

													// LAST DATA PROCESSED!

													// Create Sifter from Directory
													_STAT("Created Directory üòÅ")
													_STAT("Creating Sifter for Search ...")
													sifter = new Sifter(myDirectory);
													_STAT("	‚Ü≥ Created Sifter for Search.")

													// Listen to Search bar
													_STAT("Initializing Search Bar.")
													refreshResultsFromInput();
													$('#searchbar').focus();
													$('#searchbar').on('input', function(e) {
														refreshResultsFromInput();
													})

											})
										})
									})
								})
							})
						})
					})
				})
			})
		}) // <- should add a callback here - and move 'all data loaded' logic here.

		

	});
</script>


</html>
